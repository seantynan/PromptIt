<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Promptlets - PromptIt</title>
  <link rel="stylesheet" href="style/manage.css">
</head>
<body>
  <div class="container">
      <h1>
        <img class="logo"
            src="../assets/icons/PromptIt.png"
            alt="Prompt It logo"
            title="Prompt It! - AI in your right-click" />
          <span>Manage Promptlets</span>
      </h1>

    <!-- Default Promptlets Section -->
    <section>
      <h2>Default Promptlets</h2>
      <p class="section-intro">Built-in promptlets. Clone to customize.</p>
      <div class="promptlet-list" id="defaultPromptlets"></div>
    </section>

    <!-- Reset Default Promptlets Button -->
    <section class="reset-section">
      <button class="btn btn-primary btn-large" id="resetDefaultsBtn">
        ðŸ”„ Reset Default Promptlets
      </button>
    </section>

    <!-- User Promptlets Section -->
    <section>
      <h2>Your Promptlets</h2>
      <p class="section-intro">Your custom promptlets.</p>
      <div class="empty-state" id="emptyState">
          No custom promptlets yet. Click "Add New Promptlet" below to create one.
      </div>
      <div class="promptlet-list" id="userPromptlets">
      </div>
    </section>

    <!-- Add / Import / Export Promptlets -->
    <section class="add-section">
      <div class="action-row">
        <button class="btn btn-primary btn-large" id="addNewBtn">
          âž• Add New Promptlet
        </button>
        <div class="secondary-actions">
          <button class="btn btn-secondary" id="exportBtn" aria-haspopup="dialog">Export</button>
          <button class="btn btn-secondary" id="importBtn" aria-haspopup="dialog">Import</button>
        </div>
      </div>
    </section>

    <!-- Editor Panel (hidden by default) -->
    <div class="editor-panel hidden" id="editorPanel">
      <h2 id="editorTitle">Add New Promptlet</h2>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label"><a href="https://emojipedia.org/" title="Open Emojipedia to copy/paste an emoji" target="_blank" rel="noopener noreferrer" class="plain">Emoji</a></label>
          <input type="text" class="form-input form-input-small" id="emojiInput" maxlength="2" placeholder="âœ¨">
        </div>
        
        <div class="form-group validation-group" style="flex: 1;">
          <label class="form-label">Name *</label>
          <input type="text" class="form-input" id="nameInput" placeholder="My Promptlet" required>
          <div class="validation-message hidden" id="nameValidation"></div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Prompt</label>
        <textarea class="form-input" id="promptInput" placeholder="Enter your prompt here..." maxlength="7000"></textarea>
      </div>

      <!-- Advanced Settings -->
      <div class="advanced-toggle">
        <div class="advanced-header" id="advancedToggle">
          <span class="advanced-icon" id="advancedIcon">â–¶</span>
          <span>Advanced Settings</span>
        </div>
        <div class="advanced-content" id="advancedContent">
        <div class="form-group">
            <label class="form-label">Model</label>
            <select class="form-input" id="modelInput">
                <option value="gpt-5.1">GPT-5.1 (Advanced: Highest Reasoning / Complex Tasks)</option>
                <option value="gpt-4o" selected>GPT-4o (Balanced: Best Speed + Quality)</option>
                <option value="gpt-5-mini">GPT-5 Mini (Fast: Reasoning at Lower Cost)</option>
                <option value="gpt-5-nano">GPT-5 Nano (Fastest: Quick Tasks / Classification)</option>
            </select>
            <p class="help-text">
                <label class="form-label"><a href="https://openai.com/api/pricing/" title="View model pricing" target="_blank" rel="noopener noreferrer" class="plain">View model pricing</a></label>
            </p>
            </div>

          <div class="form-group">
            <label class="form-label">Temperature: <span id="tempValue">1.0</span></label>
            <input type="range" class="form-input" id="tempInput" min="0" max="2" step="0.1" value="1.0">
            <p class="help-text">Controls creativity. Lower = focused, Higher = creative</p>
          </div>

          <div class="form-group">
            <label class="form-label">Max Tokens: <span id="tokensValue">1500</span></label>
            <input type="range" class="form-input" id="tokensInput" min="100" max="16000" step="100" value="1500">
            <p class="help-text">Maximum response length. **Higher values cost more.** If your prompt fails or is cut off, try increasing this.</p>
          </div>
        </div>
      </div>

      <div class="editor-actions">
        <button class="btn btn-secondary" id="cancelBtn">Cancel</button>
        <button class="btn btn-primary" id="saveBtn">Save Promptlet</button>
      </div>
    </div>

    <!-- API Key Section -->
    <section class="api-settings">
      <h2>ðŸ”‘ OpenAI API Key</h2>
      <div class="form-group">
        <input type="password" class="form-input" id="apiKeyInput" placeholder="sk-...">
        <p class="help-text">Stored locally only â€” never sent anywhere except to OpenAI's API.</p>
      </div>
      <button class="btn btn-primary" id="saveKeyBtn">Save API Key</button>
    </section>
  </div>

  <!-- Export Modal -->
  <div class="modal hidden" id="exportModal" role="dialog" aria-modal="true" aria-labelledby="exportModalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="exportModalTitle">Export Promptlets</h3>
        <button class="btn-icon" id="closeExportModal" aria-label="Close export modal">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="modal-section">
          <h4>Export Options</h4>
          <div class="radio-group">
            <label><input type="radio" name="exportScope" value="all" checked> All Promptlets</label>
            <label><input type="radio" name="exportScope" value="selected"> Selected Promptlets</label>
          </div>
          <p class="help-text">Only your custom promptlets are available for export.</p>
          <div id="exportSelectionPanel" class="selection-panel hidden" aria-live="polite">
            <div class="selection-toolbar">
              <button class="link-btn" id="selectAllPromptlets" type="button">Select All</button>
              <button class="link-btn" id="deselectAllPromptlets" type="button">Deselect All</button>
            </div>
            <div class="selection-list" id="exportPromptletList"></div>
            <div class="selection-hint hidden" id="exportSelectionHint">Select at least one promptlet to export.</div>
          </div>
        </div>

        <div class="modal-section">
          <h4>File Options</h4>
          <label class="form-label" for="exportFilename">Filename</label>
          <input id="exportFilename" class="form-input" type="text" value="my-promptlets.pi" aria-describedby="exportFilenameHelp">
          <p class="help-text" id="exportFilenameHelp">Files download as <code>.pi</code> JSON exports.</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelExportBtn">Cancel</button>
        <button class="btn btn-primary" id="confirmExportBtn" disabled>Export</button>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div class="modal hidden" id="importModal" role="dialog" aria-modal="true" aria-labelledby="importModalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="importModalTitle">Import Promptlets</h3>
        <button class="btn-icon" id="closeImportModal" aria-label="Close import modal">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="modal-section">
          <h4>Select File</h4>
          <label class="file-picker" for="importFileInput">
            <span aria-hidden="true" class="file-picker-icon">ðŸ“‚</span>
            <span>Choose a .pi file</span>
            <input id="importFileInput" type="file" accept=".pi,application/json">
          </label>
          <div class="file-name hidden" id="importFileName" aria-live="polite"></div>
          <p class="help-text">Select a .pi file exported from Prompt It!</p>
          <div class="alert hidden" id="importError" role="alert"></div>
        </div>

        <div class="modal-section hidden" id="importPreviewSection">
          <h4>Preview</h4>
          <div class="preview-summary" id="importSummary"></div>
          <div class="selection-list" id="importPreviewList"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelImportBtn">Cancel</button>
        <button class="btn btn-primary" id="confirmImportBtn" disabled>Import</button>
      </div>
    </div>
  </div>

  <script src="promptletUtils.js"></script>
  <script src="manage.js"></script>
</body>
</html>